# System Tune Agent (Go 版本)

一个用 Go 语言编写的轻量级系统资源监控和调节工具，能够动态调整自身的 CPU 和内存占用，使系统总体资源使用率维持在设定的阈值附近。

## 🚀 Go 版本的优势

- **无运行时依赖**: 编译成单一可执行文件，无需安装 Go 环境
- **跨平台支持**: 一次编译，支持 Linux、Windows、macOS
- **高性能**: 接近原生 C 的性能，比 Java 版本更高效
- **低内存占用**: 比 JVM 版本节省大量内存
- **快速启动**: 毫秒级启动，无 JVM 预热时间
- **精确控制**: 更精确的资源控制和实时响应

## 📦 快速开始

### 方式一：直接下载可执行文件

从 releases 页面下载对应平台的可执行文件：
- `system-tune-agent-linux-amd64` - Linux 64位
- `system-tune-agent-windows-amd64.exe` - Windows 64位  
- `system-tune-agent-darwin-amd64` - macOS Intel
- `system-tune-agent-darwin-arm64` - macOS Apple Silicon

### 方式二：从源码构建

```bash
# 克隆项目
git clone <repository-url>
cd system-tune-agent

# 构建 (需要 Go 1.19+)
./build.sh        # Linux/macOS
# 或
build.bat         # Windows

# 运行
./system-tune-agent -c 75 -m 75
```

## 🛠️ 使用方法

### 基本用法

```bash
# 使用默认设置 (CPU: 75%, 内存: 75%)
./system-tune-agent

# 自定义阈值
./system-tune-agent -c 80 -m 70

# 查看帮助
./system-tune-agent --help
```

### 命令行参数

| 参数 | 简写 | 描述 | 默认值 |
|------|------|------|--------|
| `--cpu` | `-c` | CPU 使用率阈值 (1-100) | 75 |
| `--memory` | `-m` | 内存使用率阈值 (1-100) | 75 |
| `--help` | `-h` | 显示帮助信息 | - |

## 📊 工作原理

### 🔄 动态平衡算法 (新特性)
- **智能感知**: 实时监控系统基础占用和自身占用
- **动态调节**: 当其他进程占用增加时，自动减少自身占用
- **精确控制**: 基于目标阈值和当前基础占用计算最优自身占用
- **平滑过渡**: 避免资源使用率剧烈波动，确保系统稳定

### 🧠 智能算法特性
- **平滑调节**: 避免忽高忽低，维持稳定的资源使用率
- **动态强度**: CPU 强度 0-100% 可调，精确控制
- **渐进式内存管理**: 逐步分配和释放内存，避免突变
- **实时监控**: 2秒间隔监控，快速响应系统变化
- **自适应释放**: 其他进程占用上升时主动释放资源

### 🎯 CPU 动态平衡策略
```
基础占用 >= 阈值    → 立即停止自身占用
目标自身占用 > 5%   → 快速增加 (±10-20%)
目标自身占用 ≤ 5%   → 缓慢调整 (±2-5%)
需要减少占用       → 根据差距快速/缓慢减少
```

### 💾 内存动态平衡策略
```
基础占用 >= 阈值    → 立即释放自身占用
目标差距 > 5%      → 快速分配 (大块)
目标差距 ≤ 5%      → 缓慢分配 (小块)
需要减少 > 5%      → 快速释放 50%
需要减少 ≤ 5%      → 缓慢释放 20%
```

## 🔧 系统要求

- **Linux**: 任何现代 Linux 发行版
- **Windows**: Windows 7 或更高版本
- **macOS**: macOS 10.12 或更高版本
- **内存**: 至少 50MB 可用内存
- **权限**: 普通用户权限即可

## 📈 性能对比

| 指标 | Go 版本 | Java 版本 |
|------|---------|-----------|
| 文件大小 | ~8MB | ~50MB+ |
| 启动时间 | <100ms | 2-5s |
| 内存占用 | ~10-20MB | ~100MB+ |
| CPU 开销 | 极低 | 中等 |
| 响应速度 | 毫秒级 | 秒级 |

## 🎯 使用场景

### 1. 服务器压力测试
```bash
# 模拟高负载环境
./system-tune-agent -c 90 -m 85
```

### 2. 性能基准测试
```bash
# 精确控制资源使用率
./system-tune-agent -c 75 -m 70
```

### 3. 系统预热
```bash
# 为突发负载预留资源
./system-tune-agent -c 60 -m 60
```

### 4. 开发环境模拟
```bash
# 模拟生产环境资源使用情况
./system-tune-agent -c 80 -m 75
```

## 🔍 监控输出示例

### 正常运行状态
```
🚀 System Tune Agent 启动 (Go 版本 - 动态平衡优化)
🎯 CPU 阈值: 75.0%
🎯 内存阈值: 75.0%
⏱️ 监控间隔: 2s
🖥️ CPU 核心数: 8
✨ 动态平衡模式：当其他进程占用增加时，自动减少自身占用
⚠️ 按 Ctrl+C 停止程序

📊 初始状态 - CPU: 15.2%, 内存: 32.1%

当前状态 - 总CPU: 45.2%, 总内存: 52.1% | 基础CPU: 15.2%, 基础内存: 32.1% | 自身CPU: 30.0%, 自身内存: 20.0%
🎯 调整CPU强度: 0% -> 35% (目标自身占用: 59.8%, 当前: 30.0%)
启动 8 个 CPU 消费线程
📊 内存状态 - 总: 52.1%, 基础: 32.1%, 自身: 20.0% -> 目标: 42.9%, 差距: 22.9%, 已分配块: 15
🚀 开始增加内存占用，目标自身占用: 42.9%
💾 分配内存块: 15MB (目标差距: 22.9%)
```

### 动态平衡响应
```
当前状态 - 总CPU: 78.5%, 总内存: 76.8% | 基础CPU: 65.2%, 基础内存: 55.1% | 自身CPU: 13.3%, 自身内存: 21.7%
🔄 其他进程CPU占用过高(65.2% >= 75.0%)，停止自身CPU占用
🎯 调整CPU强度: 35% -> 0% (目标自身占用: 0.0%, 当前: 13.3%)
停止 CPU 占用
📊 内存状态 - 总: 76.8%, 基础: 55.1%, 自身: 21.7% -> 目标: 19.9%, 差距: -1.8%, 已分配块: 25
🔽 缓慢释放内存 (差距: -1.8%)
🗑️ 释放 5 个内存块 (20%)
```

## 🛡️ 安全说明

- 程序只消耗系统资源，不访问敏感数据
- 使用 Ctrl+C 可以安全停止并释放所有资源
- 不需要管理员权限
- 不会修改系统配置或文件

## 🔧 开发构建

### 环境要求
- Go 1.19 或更高版本
- 网络连接 (下载依赖)

### 构建命令
```bash
# 下载依赖
go mod tidy

# 构建当前平台
go build -o system-tune-agent main.go

# 交叉编译
GOOS=linux GOARCH=amd64 go build -o system-tune-agent-linux main.go
GOOS=windows GOARCH=amd64 go build -o system-tune-agent.exe main.go
```

## 📄 许可证

MIT License