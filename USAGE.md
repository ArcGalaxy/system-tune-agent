# System Tune Agent - 使用说明

## 🎯 动态平衡版本特性

这个版本新增了**动态平衡功能**，能够智能感知其他进程的资源占用变化，并自动调整自身占用以维持系统总体使用率在目标阈值附近。

### ✨ 核心优势
- **智能感知**: 实时区分基础占用和自身占用
- **动态调节**: 其他进程占用增加时，自动减少自身占用
- **精确控制**: 基于目标阈值计算最优自身占用
- **平滑过渡**: 避免资源使用率剧烈波动

## 📦 快速开始

### 1. 选择对应平台的文件
```bash
# Linux 64位
./system-tune-agent-linux-amd64

# Linux ARM64 (如树莓派等)
./system-tune-agent-linux-arm64

# Windows 64位
system-tune-agent-windows-amd64.exe

# Windows ARM64
system-tune-agent-windows-arm64.exe

# macOS Intel
./system-tune-agent-darwin-amd64

# macOS Apple Silicon (M1/M2)
./system-tune-agent-darwin-arm64
```

### 2. 基本使用
```bash
# 使用默认设置 (CPU: 75%, 内存: 75%)
./system-tune-agent-linux-amd64

# 自定义阈值
./system-tune-agent-linux-amd64 -c 80 -m 70

# 查看帮助
./system-tune-agent-linux-amd64 --help
```

## 🔍 动态平衡演示

### 场景1: 正常启动
```bash
./system-tune-agent-linux-amd64 -c 60 -m 60
```
程序会逐步增加CPU和内存占用，直到系统总使用率达到60%。

### 场景2: 其他进程占用增加
当你启动其他程序（如浏览器、编译任务等）时：
- 程序会检测到基础占用增加
- 自动减少自身的CPU/内存占用
- 确保系统总使用率仍维持在目标阈值

### 场景3: 其他进程占用减少
当其他程序结束后：
- 程序会检测到基础占用减少
- 自动增加自身占用
- 重新达到目标使用率

## 📊 输出说明

### 状态显示格式
```
当前状态 - 总CPU: 75.2%, 总内存: 68.5% | 基础CPU: 45.2%, 基础内存: 48.1% | 自身CPU: 30.0%, 自身内存: 20.4%
```

- **总CPU/内存**: 系统当前总使用率
- **基础CPU/内存**: 其他进程的占用（不包含本程序）
- **自身CPU/内存**: 本程序的估算占用

### 关键提示信息
- `🔄 其他进程CPU占用过高，停止自身CPU占用` - 检测到外部占用过高，主动释放
- `🎯 调整CPU强度` - 正在调整自身占用强度
- `💾 分配内存块` - 正在增加内存占用
- `🗑️ 释放内存块` - 正在减少内存占用

## 🧪 测试脚本

包含的 `test-dynamic-balance.sh` 可以帮你测试动态平衡功能：

```bash
chmod +x test-dynamic-balance.sh
./test-dynamic-balance.sh
```

该脚本会：
1. 启动 system-tune-agent
2. 等待其稳定运行
3. 启动额外的CPU和内存消费进程
4. 观察 agent 如何自动调整

## ⚙️ 参数说明

| 参数 | 简写 | 描述 | 默认值 | 范围 |
|------|------|------|--------|------|
| `--cpu` | `-c` | CPU 使用率阈值 | 75 | 1-100 |
| `--memory` | `-m` | 内存使用率阈值 | 75 | 1-100 |
| `--help` | `-h` | 显示帮助信息 | - | - |

## 🎯 使用场景

### 1. 服务器压力测试
```bash
# 模拟高负载，但允许其他进程优先使用资源
./system-tune-agent-linux-amd64 -c 90 -m 85
```

### 2. 开发环境资源预热
```bash
# 预热系统，为突发任务预留资源
./system-tune-agent-linux-amd64 -c 60 -m 60
```

### 3. 性能基准测试
```bash
# 精确控制资源使用率进行测试
./system-tune-agent-linux-amd64 -c 75 -m 70
```

### 4. 系统稳定性测试
```bash
# 长时间运行，测试系统在特定负载下的稳定性
./system-tune-agent-linux-amd64 -c 80 -m 75
```

## 🛡️ 安全说明

- ✅ 只消耗系统资源，不访问敏感数据
- ✅ 使用 Ctrl+C 可以安全停止并释放所有资源
- ✅ 不需要管理员权限
- ✅ 不会修改系统配置或文件
- ✅ 自动检测并避免过度占用系统资源

## 🔧 故障排除

### 问题1: 程序无法启动
```bash
# 检查文件权限
chmod +x system-tune-agent-*

# 检查系统架构
uname -m  # x86_64 对应 amd64, aarch64 对应 arm64
```

### 问题2: 资源占用不准确
- 程序使用估算算法，可能存在1-3%的误差
- 在高负载系统上精度会更高
- 建议运行几分钟让程序自我校准

### 问题3: 动态平衡不敏感
- 确保监控间隔足够（默认2秒）
- 其他进程的占用变化需要超过阈值才会触发调整
- 可以通过输出日志观察检测过程

## 📞 技术支持

如果遇到问题，请提供以下信息：
- 操作系统和架构 (`uname -a`)
- 程序版本和启动参数
- 完整的输出日志
- 系统当前负载情况 (`top` 或 `htop` 截图)